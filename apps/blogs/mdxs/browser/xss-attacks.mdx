---
title: XSS攻击
description: ""
date: 2024/02/01
tags: ["浏览器"]
poster: "https://img0.baidu.com/it/u=3542748506,4060302361&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500"
---

## 介绍

Cross-Site Scripting(跨站脚本攻击) 简称 XSS，是一种代码注入攻击。攻击者通过在目标网站上注入恶意脚本，使之在用户的浏览器上运行。
利用这些恶意脚本，攻击者可获取用户的敏感信息如 Cookie、SessionID 等，进而危害数据安全。

XSS 的本质是恶意代码未经过滤，与网站的正常代码混在一起；浏览器无法分辨哪些脚本是可信的，导致恶意脚本被执行。
而由于直接在用户的浏览器执行，恶意代码能够直接获取用户的信息，或者利用这些信息冒充用户向网站发起攻击者定义的请求。

## 分类

根据攻击的来源，XSS 攻击可分为存储型、反射型和 DOM 型三种。

### 存储型 XSS

一般攻击步骤：

1. 攻击者将恶意代码提交到目标网站的数据库中。
2. 用户打开目标网站时，网站服务器将恶意代码从数据库取出并返回给浏览器。
3. 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。
4. 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

这种攻击常见于带有用户保存数据的网站功能，如论坛发帖、评论、用户私信等。

### 反射型 XSS

一般攻击步骤：

1. 攻击者构造出特殊的 URL，其中包含恶意代码。
2. 用户打开带有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器。
3. 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。
4. 恶意代码窃取用户数据并发送给攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

反射型 XSS 跟存储型 XSS 的区别是：存储型 XSS 的恶意代码存在数据库里，反射型 XSS 的恶意代码存在 URL 里。

反射型 XSS 漏洞常见于通过 URL 传递参数的功能，如网站搜索、跳转等。

### DOM 型 XSS

一般攻击步骤：

1. 攻击者构造出特殊的 URL，其中包含恶意代码。
2. 用户打开带有恶意代码的 URL。
3. 用户浏览器接收到响应后解析执行，前端 JavaScript 取出 URL 中的恶意代码并执行。
4. 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

DOM 型 XSS 跟前两种 XSS 的区别在于 DOM 型 XSS 攻击中取出和执行恶意代码由浏览器完成，属于前端 JavaScript 自身的安全漏洞，而其他两种 XSS 都属于服务端端安全漏洞。

## 预防

输入过滤

1. 防止 HTML 中出现注入
2. 防止 JavaScript 在执行时，执行恶意代码。

存储型和反射型 XSS 都是在服务端取出恶意代码后，插入到响应 HTML 里的，攻击者刻意编写的攻击代码被内嵌到代码中被浏览器所执行。

预防这两种漏洞，有两种常见做法：

1. 改成纯前端渲染，把代码和数据分隔开。
2. 对 HTML 充分转义。

DOM 型 XSS 攻击，实际上是网站前端 JavaScript 代码本身不够严谨，把不可信的数据当作代码执行了。

在使用.innerHTML .outerHTML document.write 时需要特别小心。而应尽量使用 .textContent setAttribute 等。

其他 XSS 防范措施

Content Security Policy

严格的 CSP 在 XSS 的防范中可以起到以下作用

- 禁止加载外域代码，防止复杂的攻击逻辑。
- 禁止外域提交，网站被攻击后，用户的数据不会泄漏到外域。
- 禁止内联脚本执行（规则较严格）。
- 禁止未授权的脚本执行。
- 合理使用上报可以及时发现 XSS。

输入内容长度控制

其他安全措施

- HTTP-only Cookie: 禁止 JavaScript 读取某些敏感 Cookie，攻击者完成 XSS 注入后也无法窃取此 Cookie。
- 添加验证码，防止脚本冒充用户提交危险操作。
